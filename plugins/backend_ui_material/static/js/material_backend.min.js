function json(c,d,a,b){$.ajax({url:c,type:"POST",cache:false,dataType:"json",data:d,async:!1,success:function(f,e,g){a(f,e,g)},error:function(e,g,f){void 0==b?toastr.error(f.message):b(f.message)}})}function json_as(c,d,a,b){$.ajax({url:c,type:"POST",cache:false,dataType:"json",contentType:"application/json",data:d,async:1,success:function(f,e,g){a(f,e,g)},error:function(e,g,f){void 0==b?toastr.error(f.message):b(f.message)}})}function ajax(c,d,a,b){$.ajax({url:c,type:"GET",cache:true,data:d,async:true,success:function(f,e,g){a(f,e,g)},error:function(g,e,f){if(b){b(g.responseText)}else{window.alert(f.message)}}})}function ajax_post(c,d,a,b){$.ajax({url:c,type:"POST",cache:true,data:d,async:true,success:function(f,e,g){a(f,e,g)},error:function(g,e,f){if(b){b(g.responseText)}else{window.alert(f.message)}}})}var material_backend={store:"",account:"",timezone:0,debug_item:null,color_list:["bg-light-blue-a400","bg-red-a400","bg-red-a300","bg-red-900","bg-red-600","bg-pink-900","bg-pink-700","bg-purple-900","bg-purple-600","bg-indigo-900","bg-light-blue-a400","bg-blue-grey-900","bg-cyan-900","bg-teal-900","bg-green-900","bg-green-800","bg-lime-900","bg-yellow-900","bg-orange-a400","bg-deep-orange-800","bg-deep-orange-900","bg-brown-900","bg-brown-800","bg-grey-900","bg-grey-800","bg-grey-600","bg-orange-800"],change_color:function(d){if(window.localStorage){localStorage.setItem("nav_color",d)}var c=$(".navbar-bg");var b=c.attr("class").split(/\s+/);var a="";$.each(b,function(e,f){if(f.indexOf("bg-")>=0){a=f}});c.removeClass(a).addClass(d);a=a.replace("bg-","");d=d.replace("bg-","");$("."+a).removeClass(a).addClass(d)},next_color:function(){var c=$(".navbar-header");var b=c.attr("class").split(/\s+/);var a="";$.each(b,function(d,e){if(e.indexOf("bg-")>=0){a=e}});$.each(material_backend.color_list,function(d,e){if(e==a){if(d==material_backend.color_list.length-1){material_backend.change_color(material_backend.color_list[0])}else{material_backend.change_color(material_backend.color_list[d+1])}}})},loading_link:null,cache:{set:function(b,e){var c=(b.indexOf("cache=local")>=0);if(c){if(window.localStorage){var a=localStorage.getItem("cache_list");var d=[b];if(a){d=a.split("||*||");if(a.indexOf(b)<0){if(d.length>10){localStorage.removeItem(d[0]);d.splice(d,1)}d.push(b)}}localStorage.setItem(b,e);localStorage.setItem("cache_list",d.join("||*||"))}}},get:function(a){if(window.localStorage){return localStorage.getItem(a)}else{return undefined}}},page:{onClick:function(b){var a=$(this).attr("href");if(a=="#"||a==undefined){b.stopPropagation();b.preventDefault();return}if(a.indexOf("#")<0&&a.indexOf("javascript:")<0){b.stopPropagation();b.preventDefault();material_backend.page.load($(this).attr("href"),true);if($(this).parent().hasClass("site-menu-item")){$(".site-menu-item.action").removeClass("action");$(this).parent().addClass("action");$(".navbar-brand-text").html($(this).text())}}},load:function(c,a){use_cache=(c.indexOf("cache=local")>=0);if(c=="/admin/logout"){$("#page").html('<div style="text-align: center;margin: 18px;">正在登出...</div>');ajax(c,null,function(){location.href="/admin/login"},function(){location.href="/admin/login"});return}material_backend.loading_link=c;var b=material_backend.cache.get(c);if(use_cache&&b){$("#page").html(b);$.components.init("moment",material_backend.timezone)}else{$("#page").html('<div style="text-align: center;margin: 18px;">載入中...</div>')}if(a){window.history.pushState({url:c,time:new Date().getTime()},"","/admin#"+c)}ajax(c,null,material_backend.page.after_load,material_backend.page.after_load)},after_load:function(c,a,d){material_backend.notifications.reset(480);toastr.clear();var b=d.getResponseHeader("Request-Url");material_backend.cache.set(b,c);if(b!=material_backend.loading_link){return false}material_backend.loading_link=null;$("#page").html(c).find("form").each(function(){if($(this).hasClass("ajax_form")!=true){$(this).submit(material_backend.page.submit);$(this).addClass("ajax_form")}});material_backend.page.checkResponseHeader(d);if($(".auto-title").length>0){$(".navbar-brand-text").html($(".auto-title").text())}$.components.init("moment")},checkResponseHeader:function(d){var b=d.getResponseHeader("Request-Url");var c=d.getResponseHeader("Request-Method");if(c!="GET"){material_backend.notifications.refresh()}var a=d.getResponseHeader("Command-Redirect");if(a){return material_backend.page.load(a,true)}$(".site-menu-item a").each(function(){if($(this).attr("href")==b){$(".site-menu-item.action").removeClass("action");$(this).parent().addClass("action");if($(this).parent().parent().hasClass("site-menu-sub")){var e=$(this).parent().parent().parent().attr("id");$('a[data-target="#'+e+'"]').parent().addClass("action")}return false}})},submit:function(c){c.stopPropagation();c.preventDefault();var d=$(this).serializeArray();$("#detailArea input:checkbox").each(function(){if(this.checked==false){console.log($(this).attr("name"));d=d+"&"+$(this).attr("name")+"="}});var a={};for(var b=0;b<d.length;b++){a[d[b].name]=d[b].value}json_as($(this).attr("action"),JSON.stringify(a),material_backend.page.after_submit,material_backend.page.after_submit)},after_submit:function(b,c,a){$(".has-error").removeClass("has-error");material_backend.notifications.refresh();if(b.errors){$.each(b.errors,function(d,e){$("#"+d).next().text(e.join("<br />")).parent().parent().addClass("has-error")})}}},notifications:{list:[],timer:2,idle:460,frequency:60,get_data:function(){json_as("/admin/flash_message/get_messages.json",material_backend.notifications.show,material_backend.notifications.show)},load:function(){material_backend.notifications.timer--;if(material_backend.notifications.frequency<150&&material_backend.notifications.idle%2){material_backend.notifications.frequency++}if(material_backend.notifications.timer==0){if(material_backend.notifications.idle>300){material_backend.notifications.timer=material_backend.notifications.frequency;material_backend.notifications.get_data()}else{material_backend.notifications.timer=5}}material_backend.notifications.idle--;if(material_backend.notifications.idle<0){material_backend.notifications.idle=300;material_backend.notifications.get_data()}},show:function(f){for(var b in f){var d=f[b];d.id=b;if(d.message===undefined){continue}var e=moment.unix(b);d.created=e.format();if(material_backend.notifications.list.indexOf(d.id)<0){material_backend.notifications.list.push(d.id);var c="";if(!d.is_read){c="bg-green-600"}else{c="bg-grey-400"}var a='<a class="list-group-item notifications-item" href="#" data-sort="'+d.id+'" role="menuitem" id="'+d.id+'"><div class="media"><div class="media-left padding-right-10"><i class="icon zmdi zmdi-comment '+c+' white icon-circle" aria-hidden="true"></i></div><div class="media-body"><h6 class="media-heading moment" data-moment-func="fromNow">'+d.created+'</h6><div class="media-detail">'+d.message+"</div></div></div></a>";if($(".notifications-item").length>0){$(".notifications-item").each(function(){if(parseFloat($(this).data("sort"))<parseFloat(d.id)){$(a).insertBefore(this);return false}})}else{$("#notifications-content").prepend(a)}material_backend.debug_item=d}}$(".badge.badge-info.up").text($("#notifications-content .bg-green-600").length);$.components.init("moment")},read:function(a){$(a).find(".bg-green-600").removeClass("bg-green-600").addClass("bg-grey-400");$(".badge.badge-info.up").text($("#notifications-content .bg-green-600").length)},reset:function(a){material_backend.notifications.idle=a;if(material_backend.notifications.frequency>30){material_backend.notifications.frequency-=10}if(material_backend.notifications.timer>15){material_backend.notifications.timer-=5}},refresh:function(){material_backend.notifications.timer=1}},interval:function(){material_backend.notifications.load();$("#process_box").change()}};(function(b){var a=window.Site;a.run();b.fn.decimalOnly=function(){b(this).keydown(function(f){if(f.keyCode==46||f.keyCode==8||f.keyCode==9||f.keyCode==27||f.keyCode==13||(f.keyCode==65&&f.ctrlKey===true)||(f.keyCode>=35&&f.keyCode<=39)||(f.keyCode>=111&&f.keyCode<=123)){return}else{if(f.keyCode==190){if(b(this).val().indexOf(".")!==-1){f.preventDefault()}else{return}}else{if(f.shiftKey||(f.keyCode<48||f.keyCode>57)&&(f.keyCode<96||f.keyCode>105)){f.preventDefault()}}}})};b.fn.numericOnly=function(){b(this).keydown(function(f){if(f.keyCode==46||f.keyCode==8||f.keyCode==9||f.keyCode==27||f.keyCode==13||(f.keyCode==65&&f.ctrlKey===true)||(f.keyCode>=35&&f.keyCode<=39)||(f.keyCode>=111&&f.keyCode<=123)){return}else{if(f.shiftKey||(f.keyCode<48||f.keyCode>57)&&(f.keyCode<96||f.keyCode>105)){f.preventDefault()}}})};window.onpopstate=function(){var f=window.history.state;if(f!=null){material_backend.page.load(f.url,false)}};var c=window.location.hash;if(c){c=c.replace("#/","/");b(".site-menu a").each(function(){if(b(this).attr("href")==c){b(this).parent().addClass("action");return false}});setTimeout(function(){material_backend.page.load(c,false)},1)}var d=b(".navbar-bg");if(window.localStorage){var e=localStorage.getItem("nav_color");if(e){material_backend.change_color(e)}else{localStorage.setItem("nav_color",d.data("color"))}}material_backend.account=d.data("account");material_backend.store=d.data("store");material_backend.timezone=parseInt(d.data("timezone"));b("body").removeClass("hide");setTimeout(material_backend.notifications.load,10);setInterval(material_backend.interval,1000)})(jQuery);