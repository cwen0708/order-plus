function json(c,d,a,b){$.ajax({url:c,type:"POST",cache:false,dataType:"json",data:d,async:!1,success:function(e){a(e)},error:function(e,g,f){void 0==b?show_tom_message(f.message):b(f.message)}})}function json_as(c,d,a,b){$.ajax({url:c,type:"POST",cache:false,dataType:"json",data:d,async:1,success:function(e){a(e)},error:function(e,g,f){void 0==b?show_tom_message(f.message):b(f.message)}})}function ajax(c,d,a,b){$.ajax({url:c,type:"GET",cache:true,data:d,async:true,success:function(e){a(e)},error:function(g,e,f){if(b){b(g.responseText)}else{window.alert(f.message)}}})}function ajax_post(c,d,a,b){$.ajax({url:c,type:"POST",cache:true,data:d,async:true,success:function(e){a(e)},error:function(g,e,f){if(b){b(g.responseText)}else{window.alert(f.message)}}})}var drap_style_timer=null;function onDragStart(a){a.preventDefault();a.stopPropagation();$("html").addClass("dropping");$(".img_selector_div, .imgs_selector_div").parent().parent().addClass("dropping-box")}function onDragEnd(a){a.preventDefault();a.stopPropagation();drap_style_timer=setTimeout(function(){$("html").removeClass("dropping");$(".img_selector_div, .imgs_selector_div").parent().parent().removeClass("dropping-box")},1000)}function onDragOver(a){a.preventDefault();a.stopPropagation();clearTimeout(drap_style_timer);$("html").addClass("dropping");$(".img_selector_div, .imgs_selector_div").parent().parent().addClass("dropping-box")}function onDrop(a){var c=a.dataTransfer.files;a.preventDefault();$("html").removeClass("dropping");$(".img_selector_div, .imgs_selector_div").parent().parent().removeClass("dropping-box");if(c.length>10){backend.message.insert("danger","錯誤","一次可上傳 10個文件",undefined);return}for(var b=0;b<c.length;b++){console.log(a.target);backend.uploader.addFile(c[b],a.target)}}var backend={dom:{menu:null,menu_firstLevel:null,menu_secondLevel:null,list:null,detail:null,search_input:null,search_button:null,message:null,message_button:null,message_temp_html:null},menu:{init:null,firstLoaded:false,firstLevel:{click:null},secondLevel:{click:null}},list:{load:null,afterLoad:null,reload:null,lastUrl:"",isLock:false},detail:{load:null,afterLoad:null,afterSubmit:null,lastUrl:"",show:null,hide:null,isShow:false,isLock:false},grid:{selectRecord:null,unselectRecord:null,editRecord:null,lastSelectRecord:null,lastTarget:null},method:{makeAjaxForm:null,reSize:null,deleteRecordCheck:null,search:null},uploader:{addFile:null,start:null},message:{ui:{show:null,hide:null,hideTimer:null,hideTimerCount:5},list:[],change:null,insert:null,afterInsert:null,showAll:null},selector:{image:{last_target:null,last_target_editor:null,options:{success:function(a){backend.selector.image.selected(a[0].link)},cancel:function(){},linkType:"direct",multiselect:false,extensions:[".jpg",".gif",".jpeg",".png"]},server_selected:null,selected:null},images:{last_target:null,options:{success:function(b){var c=[];for(var a=0;a<b.length;a++){c.push(b[a].link)}backend.selector.images.selected(c)},cancel:function(){},linkType:"direct",multiselect:true,extensions:[".jpg",".gif",".jpeg",".png"]}}}};Object.defineProperty(backend.message.list,"push",{configurable:false,enumerable:false,writable:false,value:function(){for(var b=0,c=this.length,a=arguments.length;b<a;b++,c++){this[c]=arguments[b];backend.message.afterInsert()}return c}});backend.menu.init=function(){$(window).resize(function(){$(".sidebar .main-nav").height($(window).height()-100)}).resize();backend.detail.isShow=false;$(backend.dom.menu_firstLevel).click(backend.menu.firstLevel.click);$(backend.dom.menu_secondLevel).click(backend.menu.secondLevel.click);$(backend.dom.menu_secondLevelP).click(function(a){$(backend.dom.menu_secondLevel).click(backend.menu.secondLevel.click);$(this).find("a").first().click()});$(backend.dom.menu_firstLevel).first().click();setTimeout(function(){$(backend.dom.search_button).click(function(){event.stopPropagation();event.preventDefault();backend.method.search($(backend.dom.search_input).val())});$(backend.dom.search_input).keyup(function(a){if(a.which==13){a.preventDefault();$(backend.dom.search_button).click()}});$(".header .search").slideDown();$(window).click(function(a){if($(a.target).parents(backend.dom.message).length==0&&$(a.target).parents(backend.dom.message_button).length==0&&$(a.target).hasClass("message-box-button")==false&&$(a.target).hasClass("show-message")==false&&$(a.target).hasClass("alert-close")==false){backend.message.ui.hide()}});$("body").append(backend.dom.message_temp_html).on("click",".select-one .images-selector-box",function(){if($(".select-one .images-selector-box.selected")!=$(this)){$(".select-one .images-selector-box.selected").removeClass("selected")}$(this).addClass("selected")}).on("click",".select-many .images-selector-box",function(){if($(this).hasClass("selected")){$(this).removeClass("selected")}else{$(this).addClass("selected")}}).on("dblclick",".img_selector_item",function(){var b=$(this).parent();if(b.hasClass("imgs_selector_div")){$(this).remove();var a=[];b.find(".img_selector_item").each(function(){a.push($(this).data("link"))});backend.selector.images.selected(a,b.find("textarea").attr("id"),true)}if(b.hasClass("img_selector_div")){backend.selector.image.selected("",b.find("input").attr("id"))}}).on("click",backend.dom.message_button,function(){backend.message.ui.show()})},300)};backend.menu.firstLevel.click=function(c){c.stopPropagation();c.preventDefault();var b=$(this).next();$(".main-nav li").removeClass("active");$(this).closest("li").addClass("active");if((b.is("ul"))&&(b.is(":visible"))){$(this).closest("li").removeClass("active").removeClass("is_open");b.slideUp("normal")}if((b.is("ul"))&&(!b.is(":visible"))){$(this).closest("li").addClass("is_open");$(".main-nav ul ul:visible").slideUp("normal").parent().removeClass("is_open");b.slideDown("normal")}if(b.is("ul")){if(backend.menu.firstLoaded==false){$(backend.dom.menu_secondLevel).first().click();backend.menu.firstLoaded=true}return false}else{var a=$(this).attr("href");if(a!=="#"){$(".main-nav ul > li > ul > li.sub_active").removeClass("sub_active");backend.list.load(a);backend.menu.firstLoaded=true}else{if(backend.menu.firstLoaded==false){$(backend.dom.menu_secondLevel).first().click();backend.menu.firstLoaded=true}}}};backend.menu.secondLevel.click=function(b){b.stopPropagation();b.preventDefault();var a=$(this).attr("href");if(a!=="#"){$(".main-nav ul > li > ul > li.sub_active").removeClass("sub_active");$(this).parent().addClass("sub_active");if($(this).parents("active").length==0){$(".main-nav li").removeClass("active");$(this).parents("ul").parents("li").addClass("active")}backend.list.load(a)}};backend.grid.selectRecord=function(b){if(w2ui[b.target]){var c=w2ui[b.target].getSelection();if(b.all!==undefined&&b.all===true){for(var a=0;a<w2ui[b.target].records.length;a++){c.push(parseInt(w2ui[b.target].records[a]["recid"]))}}else{if(b.recid!==undefined){c.push(parseInt(b.recid))}}}};backend.grid.unselectRecord=function(c){if(c!==undefined&&c!==null){if(w2ui[c.target]){var d=w2ui[c.target].getSelection();var a=[];for(var b=0;b<d.length;b++){if(parseInt(d[b])!==parseInt(c.recid)){a.push(d[b])}}}}else{backend.detail.hide()}};backend.grid.editRecord=function(b){if(w2ui[b.target]){var c=w2ui[b.target].getSelection();if(b.all!==undefined&&b.all===true){for(var a=0;a<w2ui[b.target].records.length;a++){c.push(parseInt(w2ui[b.target].records[a]["recid"]))}}else{if(b.recid!==undefined){c.push(parseInt(b.recid));backend.grid.showRecord(b.target,b.recid)}}}};selectRecord=backend.grid.selectRecord;unselectRecord=backend.grid.unselectRecord;editRecord=backend.grid.editRecord;backend.grid.showRecord=function(d,c){for(var b=0;b<w2ui[d].records.length;b++){if(w2ui[d].records[b]["recid"]==c){var a=w2ui[d].records[b]["edit_url"];backend.grid.lastSelectRecord=a;backend.detail.load(a)}}};backend.method.makeAjaxForm=function(b){var a=$(b);a.find("form").each(function(){if($(this).hasClass("ajax_form")==false){$(this).submit(function(c){c.stopPropagation();c.preventDefault();var d=$(this).serialize();$("#detailArea input:checkbox").each(function(){if(this.checked==false){console.log($(this).attr("name"));d=d+"&"+$(this).attr("name")+"="}});ajax_post($(this).attr("action"),d,function(e){backend.detail.afterSubmit(e)},function(e){backend.detail.afterSubmit(e)})});$(this).addClass("ajax_form")}})};backend.list.load=function(a,b){if(backend.list.isLock==true){return}backend.list.isLock=true;var c=backend.method.getRndID("load-");a=backend.method.replaceParam(a,"rnid",c);if(b==undefined||b==false){backend.detail.hide();$(backend.dom.list).html('<div class="records"><h1>載入中…</h1></div>').addClass("has-list");ajax(a,null,backend.list.afterLoad,backend.list.afterLoad)}else{ajax(a,null,function(d){backend.list.afterLoad(d)},function(d){backend.list.afterLoad(d)})}backend.list.lastUrl=a};backend.list.afterLoad=function(g){$(backend.dom.list).html(g);backend.message.showAll(backend.dom.list);var f=[];var j=0;var e=false;$(backend.dom.list).find(".records-list li").each(function(){f.push({recid:j,title:$(this).data("title"),edit_url:$(this).data("edit-url"),delete_url:$(this).data("delete-url"),sort_up_url:$(this).data("sort-up-url"),sort_down_url:$(this).data("sort-down-url"),sort_in_category:$(this).data("sort-in-category"),desc:$(this).data("desc"),html:$(this).html()});j++});if($(backend.dom.list).find(".records-list").length>0){e=true}if(e){$(backend.dom.list).addClass("has-list");backend.grid.lastTarget=backend.method.getRndID("grid-");$(backend.dom.list).find(".records-list").w2grid({name:backend.grid.lastTarget,header:"List of Names",show:{columnHeaders:false,selectColumn:true},sortData:[{field:"recid",direction:"ASC"}],records:f,columns:[{field:"list-item",caption:"",size:"100%",render:function(h,i,k){return h.html}},{field:"list-item-2",caption:"",size:"100px",render:function(h,i,k){if(h.sort_up_url!=undefined){var l=$("#mainArea .records").data("cursor");if(l==undefined||l=="None"){l="False"}h.sort_up_url=backend.method.replaceParam(h.sort_up_url,"cursor",l);h.sort_down_url=backend.method.replaceParam(h.sort_down_url,"cursor",l);if(h.sort_in_category!=undefined&&h.sort_in_category!=""){h.sort_up_url=backend.method.replaceParam(h.sort_up_url,"category",h.sort_in_category);h.sort_down_url=backend.method.replaceParam(h.sort_down_url,"category",h.sort_in_category)}return'<button class="btn btn-sort-up" onclick="backend.method.sortRecord(\''+h.sort_up_url+'\', true)">▲</button><button class="btn btn-sort-down" onclick="backend.method.sortRecord(\''+h.sort_down_url+"', true)\">▼</button>"}}},{field:"list-item-2",caption:"",size:"90px",render:function(h,i,k){return'<button class="btn btn-default" onclick="backend.detail.load(\''+h.edit_url+"')\">編輯</button>"}},{field:"list-item-2",caption:"",size:"90px",render:function(h,i,k){if(h.delete_url!=undefined){return'<button class="btn btn-default" onclick="backend.method.deleteRecordCheck(\''+h.delete_url+"')\">刪除</button>"}}}],onUnselect:unselectRecord,onDblClick:editRecord,onSelect:selectRecord});var a=w2ui[backend.grid.lastTarget].records;for(var b=0;b<a.length;b++){if(a[b]["edit_url"]==backend.detail.lastUrl){var d=a[b]["recid"];w2ui[backend.grid.lastTarget].select(d)}}}else{$(backend.dom.list).removeClass("has-list")}backend.method.makeAjaxForm(backend.dom.list);var c=0;$(backend.dom.list).find(".operation").each(function(){c=c+1});if(c==0){$("#mainArea .records-list").addClass("not-operation")}$(".btn-add-record").click(function(){event.stopPropagation();event.preventDefault();backend.detail.load($(this).attr("href"))});$(".pager a").click(function(){event.stopPropagation();event.preventDefault();backend.list.load($(this).attr("href"),true)});if(backend.detail.isShow==true){backend.detail.show()}backend.list.isLock=false;backend.method.reSize(100);backend.method.reSize(200);backend.method.reSize(300)};backend.list.reload=function(){backend.list.load(backend.list.lastUrl,true)};backend.detail.load=function(a){if(backend.detail.isLock==true){return}if(backend.detail.isShow==false){backend.detail.show()}backend.detail.isLock=true;$(backend.dom.detail).html('<section class="record"><h1> 載入中… </h1></div>');ajax(a,null,backend.detail.afterLoad,backend.detail.afterLoad);backend.detail.lastUrl=a};backend.detail.afterLoad=function(a){$(backend.dom.detail).html(a);backend.method.makeAjaxForm(backend.dom.detail);$(backend.dom.detail).find(".btn-submit").click(function(){event.stopPropagation();event.preventDefault();var b=$(this).parents("form");b.find(".field-type-rich-text-field").each(function(){var c=$(this).attr("id");if(tinyMCE.get(c)){$(this).val(tinyMCE.get(c).getContent())}$(this).change()});b.submit()});$(backend.dom.detail).find(".img_selector_div, .imgs_selector_div").each(function(){var b=$(this).prev();$(this).prev().remove();$(b).insertAfter($(this).children().first())});$(backend.dom.detail).find(".btn-cancel").click(function(){event.stopPropagation();event.preventDefault();backend.detail.hide()});$("input.field-type-date-field").w2field("date",{format:"yyyy-mm-dd"});$("input.field-type-image-property-field").parents(".form-item").addClass("form-item-with-border");$("textarea.field-type-images-property-field").parents(".form-item").addClass("form-item-with-border");$(".btn-image-open-dropbox").click(function(){backend.selector.image.last_target=$(this).data("target");Dropbox.choose(backend.selector.image.options)});$(".btn-images-open-dropbox").click(function(){backend.selector.images.last_target=$(this).data("target");Dropbox.choose(backend.selector.images.options)});$(".btn-image-open-server").click(function(){backend.selector.image.last_target=$(this).data("target");ajax("/admin/web_file/images_list",null,function(b){w2popup.open({title:"選擇圖片",body:'<div class="select-one">'+b+"</div>",buttons:'<button class="btn" onclick="backend.selector.image.server_selected(); w2popup.close();">確定</button> <button class="btn" onclick="w2popup.close();">取消</button>',width:$("body").width()*0.65,height:$("body").height()*0.65,overflow:"hidden",color:"#333",speed:"0.3",opacity:"0.8",modal:true,showClose:true})})});$(".btn-images-open-server").click(function(){backend.selector.images.last_target=$(this).data("target");ajax("/admin/web_file/images_list",null,function(b){w2popup.open({title:"選擇圖片",body:'<div class="select-many">'+b+"</div>",buttons:'<button class="btn" onclick="backend.selector.images.server_selected(); w2popup.close();">確定</button> <button class="btn" onclick="w2popup.close();">取消</button>',width:$("body").width()*0.65,height:$("body").height()*0.65,overflow:"hidden",color:"#333",speed:"0.3",opacity:"0.8",modal:true,showClose:true})})});$(".btn-image-open-google-picker").click(function(){backend.selector.image.last_target=$(this).data("target")});$(".btn-images-open-google-picker").click(function(){backend.selector.images.last_target=$(this).data("target")});$("input.field-type-color-property-field").w2field("color");backend.detail.isLock=false;backend.message.showAll(backend.dom.detail);tinyMCE.editors=[];$(".field-type-rich-text-field").each(function(){var b=$(this).prev().text();$(this).prev().remove();var d=$(this).attr("id");if(d==undefined){d=$(this).attr("name");$(this).attr("id",d)}if(d){var c=tinyMCE.createEditor(d,{theme:"modern",content_css:["/plugins/backend_ui_saimiri/static/TinyMCE/4.2.5/skins/lightgray/content.min.css"],height:400,plugins:["link image media code table preview hr anchor pagebreak textcolor fullscreen colorpicker "],toolbar:"editor_title | undo redo | styleselect | alignleft aligncenter alignright forecolor backcolor bold italic | link upload_image image media | code custom_fullscreen",statusbar:false,menubar:false,setup:function(e){e.addButton("editor_title",{title:"此為編輯器所對應的欄位名稱",text:b});e.addButton("upload_image",{title:"插入圖片",image:"/plugins/backend_ui_saimiri/static/TinyMCE/4.2.5/themes/upload_image.png",onclick:function(){backend.selector.image.last_target=e.id+"#editor";backend.selector.image.last_target_editor=e;ajax("/admin/web_file/images_list",null,function(f){w2popup.open({title:"選擇圖片",body:'<div class="select-one">'+f+"</div>",buttons:'<button class="btn" onclick="backend.selector.image.server_selected(); w2popup.close();">確定</button> <button class="btn" onclick="w2popup.close();">取消</button>',width:$("body").width()*0.65,height:$("body").height()*0.65,overflow:"hidden",color:"#333",speed:"0.3",opacity:"0.8",modal:true,showClose:true})})}});e.addButton("custom_fullscreen",{title:"全螢幕",text:"全螢幕",onclick:function(){;if($(".nav-settings").is(":visible")==true){$(".nav-settings").hide();$("#message-box-button").hide();backend.message.ui.hide()}else{$(".nav-settings").show();$("#message-box-button").show()}e.execCommand("mceFullScreen")}});e.on("init",function(f){setTimeout("$(backend.dom.detail).scrollTop(0);",10);setTimeout("$(backend.dom.detail).scrollTop(0);",20);setTimeout("$(backend.dom.detail).scrollTop(0);",300)})},convert_urls:false,relative_urls:false,remove_script_host:false});c.render()}})};backend.detail.afterSubmit=function(d){backend.list.reload();var a=$("<div>"+d+"</div>");var c=a.find(".form-item");var e=0;for(var b=0;b<c.length;b++){console.log(b)}$(backend.dom.detail+" .form-item").each(function(){if(c.eq(e).hasClass("has-error")){$(this).find(".help-block").text(c.eq(e).find(".help-block").text());$(this).addClass("has-error")}else{$(this).find(".help-block").text("");$(this).removeClass("has-error")}e++});a.find(".alert").each(function(){var f="info";var g=$(this);if(g.hasClass("alert-info")){f="info"}if(g.hasClass("alert-warning")){f="warning"}if(g.hasClass("alert-success")){f="success"}if(g.hasClass("alert-danger")){f="danger"}backend.message.insert(f,g.data("title"),g.html(),g.data("image"))})};backend.detail.show=function(){if(backend.detail.isShow==false){backend.detail.isShow=true;w2ui.layout2.show("right")}$(".btn-add-record").removeClass("detailAreaIsOpen").addClass("detailAreaIsOpen");$("#mainArea .pager").removeClass("detailAreaIsOpen").addClass("detailAreaIsOpen")};backend.detail.hide=function(){backend.detail.isShow=false;w2ui.layout2.hide("right");$(".btn-add-record").removeClass("detailAreaIsOpen");$("#mainArea .pager").removeClass("detailAreaIsOpen")};backend.method.sortRecord=function(a){ajax(a,null,function(){backend.list.reload()},function(){backend.list.reload()})};backend.method.deleteRecordCheck=function(a){w2confirm({msg:"是否要刪除此項目",title:"刪除?",yes_text:"是的, 刪除它",no_text:"取消"}).yes(function(){if(a.replace("/delete","")==backend.detail.lastUrl.replace("/edit","")){backend.detail.hide()}ajax(a,null,function(){backend.list.reload();backend.message.insert("success","刪除成功","此項目已經被刪除了")},function(){backend.list.reload();backend.message.insert("danger","刪除失敗","請確認要刪除的目標是否還存在，或稍後再試一次")})})};backend.method.reSize=function(a){setTimeout(function(){var b=$("#layout_layout2_panel_main #mainArea").width()+250;$(".btn-add-record").css("left",b-90);$(".detailAreaIsOpen.btn-add-record").css("left",b-53);var c=$("#mainArea .pager").width();$("#mainArea .pager").css("left",b-100-c);$("#mainArea .detailAreaIsOpen.pager").css("left",b-68-c)},a)};backend.method.search=function(a){if(a!=undefined&&a!=""){var b=backend.method.replaceParam(backend.list.lastUrl,"query",a);b=backend.method.replaceParam(b,"cursor","");b=b.replace("?cursor=none","?");b=b.replace("&cursor=none","");backend.list.load(b)}if(a==""){var b=backend.method.replaceParam(backend.list.lastUrl,"query","");backend.list.load(b)}};backend.message.showAll=function(a){$(a).find(".alert").each(function(){var b="info";var c=$(this);if(c.hasClass("alert-info")){b="info"}if(c.hasClass("alert-warning")){b="warning"}if(c.hasClass("alert-success")){b="success"}if(c.hasClass("alert-danger")){b="danger"}backend.message.insert(b,c.data("title"),c.html(),c.data("image"))})};backend.message.insert=function(c,f,e,d,b){var a=backend.method.getRndID("message-");if(e!=undefined&&e!=""){backend.message.list.push({kind:c,title:f,text:e,image:d,message_id:a,mini:b})}return a};backend.message.change=function(f,b,e,d,c,a){backend.message.list.push({kind:b,title:e,text:d,image:c,message_id:f,mini:a})};backend.message.afterInsert=function(){if(backend.message.list.length>0){var f=backend.message.list.pop();if(f!=undefined&&f.text!=""){var g="";var a="";var e="";switch(f.kind){case"info":a='<i class="glyphicon glyphicon-bullhorn"></i>';g="訊息";break;case"warning":a='<i class="glyphicon glyphicon-bell"></i>';g="注意";break;case"danger":a='<i class="glyphicon glyphicon-info-sign"></i>';g="錯誤";break;case"success":a='<i class="glyphicon glyphicon-ok"></i>';g="成功";break}if(f.image!=undefined&&f.image!=""){a='<i class="glyphicon"></i>';e="url("+f.image+")"}else{e="none"}if(f.title!=undefined&&f.title!=""){g=f.title}var c="#"+f.message_id;if($(c).length==0){var b='<li class="msg not-ready" style="display:none;" id="'+f.message_id+'"><div class="alert"><div class="alert-tag" style="background-size: cover;"></div><button type="button" class="alert-close close" data-dismiss="alert">×</button><span class="alert-moment"></span><span class="alert-title"></span><span class="alert-text"></span></div></li>';$(backend.dom.message).find("ul").prepend(b)}$(c).find(".alert-tag").html(a).removeClass("alert-info alert-warning alert-danger alert-success").addClass("alert-"+f.kind).css("background-image",e);$(c).find(".alert-moment").data("create",moment().format());$(c).find(".alert-title").text(g);$(c).find(".alert-text").html(f.text);var d=false;if(f.mini!=undefined&&f.mini==true){d=f.mini}if(d==false){backend.message.ui.show(true)}}}};backend.message.ui.hideAuto=function(){backend.message.ui.hideTimerCount=parseInt(backend.message.ui.hideTimerCount)-1;if(backend.message.ui.hideTimerCount<=0){backend.message.ui.hide()}else{backend.message.ui.hideTimer=setTimeout(backend.message.ui.hideAuto,1000)}};backend.message.ui.show=function(a){$(".alert-moment").each(function(){var b=$(this).data("create");$(this).text(moment(b).fromNow())});if($(backend.dom.message).hasClass("is_show")){$("#message-box .msg.not-ready").fadeIn(function(){$(this).removeClass("not-ready")})}else{$(backend.dom.message).show(function(){$("#message-box .msg.not-ready").fadeIn(function(){$(this).removeClass("not-ready")});$(backend.dom.message).addClass("is_show")})}if($(".msg").length>25){$(".msg").last().remove()}if(a!=undefined&&a==true){clearTimeout(backend.message.ui.hideTimer);backend.message.ui.hideTimerCount=5;backend.message.ui.hideAuto()}};backend.message.ui.hide=function(){$(backend.dom.message).fadeOut();$(backend.dom.message).removeClass("is_show");backend.message.ui.hideTimerCount=0};backend.selector.image.server_selected=function(){if($(".select-one .images-selector-box.selected").length>0){var a=$(".select-one .images-selector-box.selected").first().data("link");backend.selector.image.selected(a)}};backend.selector.images.server_selected=function(){var a=[];$(".select-many .images-selector-box.selected").each(function(){a.push($(this).data("link"))});backend.selector.images.selected(a)};backend.selector.image.selected=function(a,b){if(b==undefined){b=backend.selector.image.last_target}if(b.indexOf("#editor")>0){backend.selector.image.last_target_editor.selection.setContent('<img src="'+a+'" />')}else{$("#"+b).val(a);if(a==""){$("#img-"+b).css("background-image","none").addClass("img_selector_item_none")}else{$("#img-"+b).css("background-image","url("+a+")").removeClass("img_selector_item_none")}}};backend.selector.images.selected=function(d,e,c){if(e==undefined){e=backend.selector.images.last_target}if(c==true){$("#"+e).val("");$("#"+e).parent().find(".img_selector_item").remove()}for(var b=0;b<d.length;b++){var a=$("#"+e).val()+";"+d[b];$("#"+e).val(a).parent().append('<div class="img_selector_item" data-link="'+d[b]+'" style="background-image: url('+d[b]+')"></div>')}};backend.uploader.start=function(b){if(/image\/\w+/.test(b.file.type)){var a=new FileReader();a.info=b;a.readAsDataURL(b.file);a.onload=function(d){this.info.image=this.result;backend.message.change(this.info.message_id,"info","正在上傳","等待中....",this.info.image);var c=new FormData();var f=new XMLHttpRequest();f.xhrinfo=this.info;f.upload.xhrinfo=this.info;f.open("POST",this.info.upload_url);f.onload=function(h){backend.message.change(this.xhrinfo.message_id,"success","上傳完成","100 %, 上傳完成",this.xhrinfo.image);var j=h.currentTarget.response;if(this.xhrinfo.target!=undefined){var g=this.xhrinfo.target;for(var e=0;e<10;e++){if(g.className.indexOf("img_selector_div")>=0){console.log(g.firstChild.id);backend.selector.image.selected(j,g.firstChild.id);e=11}if(g.className.indexOf("imgs_selector_div")>=0){console.log(g.firstChild.id);backend.selector.images.selected([j],g.firstChild.id);e=11}if(g.className.indexOf("mce-content-body")>=0){var k=$(g).data("id");tinyMCE.get(k).execCommand("mceInsertContent",false,'<img src="'+j+'" />');e=11}console.log(g);g=g.parentElement;if(g==null){return}}}};f.onerror=function(g){backend.message.change(this.xhrinfo.message_id,"danger","上傳失敗","請重整頁面後再試一次",this.xhrinfo.image)};f.upload.onprogress=function(g){if(g.lengthComputable){var e=(g.loaded/g.total*100|0);if(100==e){e=99.9}backend.message.change(this.xhrinfo.message_id,"info","正在上傳",e+" %",this.xhrinfo.image)}};c.append("file",this.info.file);f.send(c)}}};backend.uploader.addFile=function(b,c){var a={message_id:backend.message.insert("info","準備上傳","等待中...."),upload_url:null,file:b,target:c};ajax("/admin/web_file/get.json",null,function(d){a.upload_url=d.url;backend.uploader.start(a)},function(d){backend.message.change(a.message_id,"danger","發生錯誤","無法取得上傳的路徑，請稍候再試一次")})};var ready=false;$(function(){console.log("%c%s","color: red; background: yellow; font-size: 24px;","\u8b66\u544a\uff01");console.log("%c%s","color: black; font-size: 18px;","\u4f7f\u7528\u6b64\u63a7\u5236\u53f0\u53ef\u80fd\u6703\u8b93\u653b\u64ca\u8005\u6709\u6a5f\u6703\u5229\u7528\u540d\u70ba Self-XSS \u7684\u653b\u64ca\u65b9\u5f0f\u5192\u7528\u60a8\u7684\u8eab\u5206\uff0c\u7136\u5f8c\u7aca\u53d6\u60a8\u7684\u8cc7\u8a0a\u3002\n\u8acb\u52ff\u8f38\u5165\u6216\u8cbc\u4e0a\u4f86\u6b77\u4e0d\u660e\u7684\u7a0b\u5f0f\u78bc\u3002");var b="background-color: #fff; border: 0px solid #dfdfdf; padding: 0px;";var a=$(".layout-header").height();backend.dom.message_temp_html=$(".layout-message-area").html();$(".layout-header").remove();$().w2layout({name:"layout2",panels:[{type:"top",size:a,resizable:false,style:"background-color: #ddd;border: 0px; padding: 0px",content:$(".layout-search-area").html(),overflow:"hidden"},{type:"main",minSize:550,style:"background-color: #ffffff; border: 0px solid #dfdfdf; padding: 0px; border-right: solid 0px #ddd;",content:$(".layout-main-area").html()},{type:"right",size:"50%",resizable:true,hidden:true,style:b,content:$(".layout-side-area").html()}],onRender:function(c){backend.menu.init()},onResize:function(c){backend.method.reSize(100);backend.method.reSize(200);backend.method.reSize(300)},padding:0});$("body").w2layout({name:"layout",panels:[{type:"left",size:250,resizable:false,style:"border: 0px; padding: 0px;",content:$(".layout-menu-area").html(),overflow:"hidden"},{type:"main",style:"background-color: white;",overflow:"hidden"},{type:"preview",size:"50%",resizable:true,hidden:true,style:b,content:"preview"},{type:"bottom",size:50,resizable:true,hidden:true,style:b,content:"bottom"}],padding:0});w2ui.layout.content("main",w2ui.layout2);tinyMCE.init({content_css:["/plugins/backend_ui_saimiri/static/TinyMCE/4.2.5/skins/lightgray/content.min.css"],height:400,statusbar:false,menubar:false,convert_urls:false,relative_urls:false,remove_script_host:false});backend.dom.list="#layout_layout2_panel_main #mainArea";backend.dom.detail="#layout_layout2_panel_right #detailArea";backend.dom.menu="#layout_layout_panel_left .main-nav";backend.dom.menu_firstLevel=".main-nav > ul > li > a";backend.dom.menu_secondLevel=".main-nav ul > li > ul > li > a";backend.dom.menu_secondLevelP=".main-nav ul > li > ul > li";backend.dom.message="#message-box";backend.dom.message_button="#message-box-button";backend.dom.search_input=".search input";backend.dom.search_button=".search a";$(document).on("click",".alert-close",function(){$(this).parent().parent().remove()})});backend.method.replaceParam=function(g,f,o){g=g.replace("#/","");var n="";var e=g.substring(0,g.indexOf("?"));var l=g.substring(g.indexOf("?"),g.length);var h=0;if(g.indexOf("?")>=0){var k=l.indexOf(f+"=");if(k>=0){h=l.indexOf("&",k);if(h>=0){n=l.substring(k+f.length+1,h);l=g.replace(f+"="+n,f+"="+o)}else{n=l.substring(k+f.length+1,l.length);l=g.replace(f+"="+n,f+"="+o)}}else{l=g+"&"+f+"="+o}}else{l=g+"?"+f+"="+o}return l};backend.method.getRndID=function(d){if(d==undefined){d="grid-"}var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var e=0;e<5;e++){d+=c.charAt(Math.floor(Math.random()*c.length))}backend.grid.lastTarget=d;return d};