(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("./matchesonscrollbar"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","./matchesonscrollbar"],a)}else{a(CodeMirror)}}})(function(c){var b={style:"matchhighlight",minChars:2,delay:100,wordsOnly:false,annotateScrollbar:false,showToken:false,trim:true};function h(l){this.options={};for(var k in b){this.options[k]=(l&&l.hasOwnProperty(k)?l:b)[k]}this.overlay=this.timeout=null;this.matchesonscroll=null}c.defineOption("highlightSelectionMatches",false,function(k,m,l){if(l&&l!=c.Init){j(k);clearTimeout(k.state.matchHighlighter.timeout);k.state.matchHighlighter=null;k.off("cursorActivity",g)}if(m){k.state.matchHighlighter=new h(m);e(k);k.on("cursorActivity",g)}});function g(k){var l=k.state.matchHighlighter;clearTimeout(l.timeout);l.timeout=setTimeout(function(){e(k)},l.options.delay)}function a(l,p,n,m){var o=l.state.matchHighlighter;l.addOverlay(o.overlay=d(p,n,m));if(o.options.annotateScrollbar&&l.showMatchesOnScrollbar){var k=n?new RegExp("\\b"+p+"\\b"):p;o.matchesonscroll=l.showMatchesOnScrollbar(k,true,{className:"CodeMirror-selection-highlight-scrollbar"})}}function j(k){var l=k.state.matchHighlighter;if(l.overlay){k.removeOverlay(l.overlay);l.overlay=null;if(l.matchesonscroll){l.matchesonscroll.clear();l.matchesonscroll=null}}}function e(k){k.operation(function(){var l=k.state.matchHighlighter;j(k);if(!k.somethingSelected()&&l.options.showToken){var s=l.options.showToken===true?/[\w$]/:l.options.showToken;var r=k.getCursor(),t=k.getLine(r.line),m=r.ch,n=m;while(m&&s.test(t.charAt(m-1))){--m}while(n<t.length&&s.test(t.charAt(n))){++n}if(m<n){a(k,t.slice(m,n),s,l.options.style)}return}var p=k.getCursor("from"),q=k.getCursor("to");if(p.line!=q.line){return}if(l.options.wordsOnly&&!f(k,p,q)){return}var o=k.getRange(p,q);if(l.options.trim){o=o.replace(/^\s+|\s+$/g,"")}if(o.length>=l.options.minChars){a(k,o,false,l.options.style)}})}function f(k,p,o){var m=k.getRange(p,o);if(m.match(/^\w+$/)!==null){if(p.ch>0){var n={line:p.line,ch:p.ch-1};var l=k.getRange(n,p);if(l.match(/\W/)===null){return false}}if(o.ch<k.getLine(p.line).length){var n={line:o.line,ch:o.ch+1};var l=k.getRange(o,n);if(l.match(/\W/)===null){return false}}return true}else{return false}}function i(l,k){return(!l.start||!k.test(l.string.charAt(l.start-1)))&&(l.pos==l.string.length||!k.test(l.string.charAt(l.pos)))}function d(m,l,k){return{token:function(n){if(n.match(m)&&(!l||i(n,l))){return k}n.next();n.skipTo(m.charAt(0))||n.skipToEnd()}}}});