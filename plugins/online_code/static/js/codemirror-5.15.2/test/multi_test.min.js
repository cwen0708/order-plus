(function(){namespace="multi_";function c(e){var d=e.listSelections();var k=(arguments.length-1)/4;if(d.length!=k){throw new Failure("expected "+k+" selections, found "+d.length)}for(var h=0,j=1;h<k;h++,j+=4){var f=Pos(arguments[j],arguments[j+1]);var g=Pos(arguments[j+2],arguments[j+3]);eqPos(d[h].anchor,f,"anchor of selection "+h);eqPos(d[h].head,g,"head of selection "+h)}}function b(e){var d=e.listSelections();var j=(arguments.length-1)/2;if(d.length!=j){throw new Failure("expected "+j+" selections, found "+d.length)}for(var g=0,h=1;g<j;g++,h+=2){eqPos(d[g].anchor,d[g].head,"something selected for "+g);var f=Pos(arguments[h],arguments[h+1]);eqPos(d[g].head,f,"selection "+g)}}testCM("getSelection",function(d){a(d,{anchor:Pos(0,0),head:Pos(1,2)},{anchor:Pos(2,2),head:Pos(2,0)});eq(d.getSelection(),"1234\n56\n90");eq(d.getSelection(false).join("|"),"1234|56|90");eq(d.getSelections().join("|"),"1234\n56|90")},{value:"1234\n5678\n90"});testCM("setSelection",function(d){a(d,Pos(3,0),Pos(0,0),{anchor:Pos(2,5),head:Pos(1,0)});c(d,0,0,0,0,2,5,1,0,3,0,3,0);d.setSelection(Pos(1,2),Pos(1,1));c(d,1,2,1,1);a(d,{anchor:Pos(1,1),head:Pos(2,4)},{anchor:Pos(0,0),head:Pos(1,3)},Pos(3,0),Pos(2,2));c(d,0,0,2,4,3,0,3,0);d.setSelections([{anchor:Pos(0,1),head:Pos(0,2)},{anchor:Pos(1,1),head:Pos(1,2)},{anchor:Pos(2,1),head:Pos(2,2)}],1);eqPos(d.getCursor("head"),Pos(1,2));eqPos(d.getCursor("anchor"),Pos(1,1));eqPos(d.getCursor("from"),Pos(1,1));eqPos(d.getCursor("to"),Pos(1,2));d.setCursor(Pos(1,1));b(d,1,1)},{value:"abcde\nabcde\nabcde\n"});testCM("somethingSelected",function(d){a(d,Pos(0,1),{anchor:Pos(0,3),head:Pos(0,5)});eq(d.somethingSelected(),true);a(d,Pos(0,1),Pos(0,3),Pos(0,5));eq(d.somethingSelected(),false)},{value:"123456789"});testCM("extendSelection",function(d){a(d,Pos(0,1),Pos(1,1),Pos(2,1));d.setExtending(true);d.extendSelections([Pos(0,2),Pos(1,0),Pos(2,3)]);c(d,0,1,0,2,1,1,1,0,2,1,2,3);d.extendSelection(Pos(2,4),Pos(2,0));c(d,2,4,2,0)},{value:"1234\n1234\n1234"});testCM("addSelection",function(d){a(d,Pos(0,1),Pos(1,1));d.addSelection(Pos(0,0),Pos(0,4));c(d,0,0,0,4,1,1,1,1);d.addSelection(Pos(2,2));c(d,0,0,0,4,1,1,1,1,2,2,2,2)},{value:"1234\n1234\n1234"});testCM("replaceSelection",function(d){var e=[{anchor:Pos(0,0),head:Pos(0,1)},{anchor:Pos(0,2),head:Pos(0,3)},{anchor:Pos(0,4),head:Pos(0,5)},{anchor:Pos(2,1),head:Pos(2,4)},{anchor:Pos(2,5),head:Pos(2,6)}];var f="123456\n123456\n123456";d.setValue(f);d.setSelections(e);d.replaceSelection("ab","around");eq(d.getValue(),"ab2ab4ab6\n123456\n1ab5ab");c(d,0,0,0,2,0,3,0,5,0,6,0,8,2,1,2,3,2,4,2,6);d.setValue(f);d.setSelections(e);d.replaceSelection("","around");eq(d.getValue(),"246\n123456\n15");c(d,0,0,0,0,0,1,0,1,0,2,0,2,2,1,2,1,2,2,2,2);d.setValue(f);d.setSelections(e);d.replaceSelection("X\nY\nZ","around");c(d,0,0,2,1,2,2,4,1,4,2,6,1,8,1,10,1,10,2,12,1);d.replaceSelection("a","around");c(d,0,0,0,1,0,2,0,3,0,4,0,5,2,1,2,2,2,3,2,4);d.replaceSelection("xy","start");c(d,0,0,0,0,0,3,0,3,0,6,0,6,2,1,2,1,2,4,2,4);d.replaceSelection("z\nf");c(d,1,1,1,1,2,1,2,1,3,1,3,1,6,1,6,1,7,1,7,1);eq(d.getValue(),"z\nfxy2z\nfxy4z\nfxy6\n123456\n1z\nfxy5z\nfxy")});function a(f){var e=[];for(var g=1;g<arguments.length;g++){var d=arguments[g];if(d.head){e.push(d)}else{e.push({head:d,anchor:d})}}f.setSelections(e,e.length-1)}testCM("indentSelection",function(d){a(d,Pos(0,1),Pos(1,1));d.indentSelection(4);eq(d.getValue(),"    foo\n    bar\nbaz");a(d,Pos(0,2),Pos(0,3),Pos(0,4));d.indentSelection(-2);eq(d.getValue(),"  foo\n    bar\nbaz");a(d,{anchor:Pos(0,0),head:Pos(1,2)},{anchor:Pos(1,3),head:Pos(2,0)});d.indentSelection(-2);eq(d.getValue(),"foo\n  bar\nbaz")},{value:"foo\nbar\nbaz"});testCM("killLine",function(d){a(d,Pos(0,1),Pos(0,2),Pos(1,1));d.execCommand("killLine");eq(d.getValue(),"f\nb\nbaz");d.execCommand("killLine");eq(d.getValue(),"fbbaz");d.setValue("foo\nbar\nbaz");a(d,Pos(0,1),{anchor:Pos(0,2),head:Pos(2,1)});d.execCommand("killLine");eq(d.getValue(),"faz")},{value:"foo\nbar\nbaz"});testCM("deleteLine",function(d){a(d,Pos(0,0),{head:Pos(0,1),anchor:Pos(2,0)},Pos(4,0));d.execCommand("deleteLine");eq(d.getValue(),"4\n6\n7");a(d,Pos(2,1));d.execCommand("deleteLine");eq(d.getValue(),"4\n6\n")},{value:"1\n2\n3\n4\n5\n6\n7"});testCM("deleteH",function(d){a(d,Pos(0,4),{anchor:Pos(1,4),head:Pos(1,5)});d.execCommand("delWordAfter");eq(d.getValue(),"foo bar baz\nabc ef ghi\n");d.execCommand("delWordAfter");eq(d.getValue(),"foo  baz\nabc  ghi\n");d.execCommand("delCharBefore");d.execCommand("delCharBefore");eq(d.getValue(),"fo baz\nab ghi\n");a(d,Pos(0,3),Pos(0,4),Pos(0,5));d.execCommand("delWordAfter");eq(d.getValue(),"fo \nab ghi\n")},{value:"foo bar baz\nabc def ghi\n"});testCM("goLineStart",function(d){a(d,Pos(0,2),Pos(0,3),Pos(1,1));d.execCommand("goLineStart");b(d,0,0,1,0);a(d,Pos(1,1),Pos(0,1));d.setExtending(true);d.execCommand("goLineStart");c(d,0,1,0,0,1,1,1,0)},{value:"foo\nbar\nbaz"});testCM("moveV",function(d){a(d,Pos(0,2),Pos(1,2));d.execCommand("goLineDown");b(d,1,2,2,2);d.execCommand("goLineUp");b(d,0,2,1,2);d.execCommand("goLineUp");b(d,0,0,0,2);d.execCommand("goLineUp");b(d,0,0);a(d,Pos(0,2),Pos(1,2));d.setExtending(true);d.execCommand("goLineDown");c(d,0,2,2,2)},{value:"12345\n12345\n12345"});testCM("moveH",function(d){a(d,Pos(0,1),Pos(0,3),Pos(0,5),Pos(2,3));d.execCommand("goCharRight");b(d,0,2,0,4,1,0,2,4);d.execCommand("goCharLeft");b(d,0,1,0,3,0,5,2,3);for(var e=0;e<15;e++){d.execCommand("goCharRight")}b(d,2,4,2,5)},{value:"12345\n12345\n12345"});testCM("newlineAndIndent",function(d){a(d,Pos(0,5),Pos(1,5));d.execCommand("newlineAndIndent");b(d,1,2,3,2);eq(d.getValue(),"x = [\n  1];\ny = [\n  2];");d.undo();eq(d.getValue(),"x = [1];\ny = [2];");b(d,0,5,1,5);a(d,Pos(0,5),Pos(0,6));d.execCommand("newlineAndIndent");b(d,1,2,2,0);eq(d.getValue(),"x = [\n  1\n];\ny = [2];")},{value:"x = [1];\ny = [2];",mode:"javascript"});testCM("goDocStartEnd",function(d){a(d,Pos(0,1),Pos(1,1));d.execCommand("goDocStart");b(d,0,0);a(d,Pos(0,1),Pos(1,1));d.execCommand("goDocEnd");b(d,1,3);a(d,Pos(0,1),Pos(1,1));d.setExtending(true);d.execCommand("goDocEnd");c(d,1,1,1,3)},{value:"abc\ndef"});testCM("selectionHistory",function(d){for(var e=0;e<3;++e){d.addSelection(Pos(0,e*2),Pos(0,e*2+1))}d.execCommand("undoSelection");eq(d.getSelection(),"1\n2");d.execCommand("undoSelection");eq(d.getSelection(),"1");d.execCommand("undoSelection");eq(d.getSelection(),"");eqPos(d.getCursor(),Pos(0,0));d.execCommand("redoSelection");eq(d.getSelection(),"1");d.execCommand("redoSelection");eq(d.getSelection(),"1\n2");d.execCommand("redoSelection");eq(d.getSelection(),"1\n2\n3")},{value:"1 2 3"})})();